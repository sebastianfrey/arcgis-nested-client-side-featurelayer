const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-B9Z2nG1U.js","./index-HVMkvd8u.js","./index-CiswRgqD.css"])))=>i.map(i=>d[i]);
import{aH as c,h6 as $,h7 as C,h8 as M,h9 as S,ha as E,eY as _,dC as f,fq as F,ax as R,bQ as m,hb as p,hc as A,hd as O,h0 as H,he as T,au as D,hf as N}from"./index-HVMkvd8u.js";function I(t){const o=[];return d($(t),o),o.length?new c(E(o[0])):null}function d(t,o){var l;if(!t)return;let e;e=t.type==="CIMTextSymbol"?t.symbol:t;const n=t.type==="CIMPolygonSymbol";if(e!=null&&e.symbolLayers){for(const r of e.symbolLayers)if(!(r.colorLocked||n&&(C(r)||M(r)&&r.markerPlacement&&S(r.markerPlacement))))switch(r.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":r.tintColor&&k(o,r.tintColor);break;case"CIMVectorMarker":(l=r.markerGraphics)==null||l.forEach(a=>{d(a.symbol,o)});break;case"CIMSolidStroke":case"CIMSolidFill":k(o,r.color);break;case"CIMHatchFill":d(r.lineSymbol,o)}}}function k(t,o){for(const e of t)if(e.join(".")===o.join("."))return;t.push(o)}function st(t,o,e){o instanceof c||(o=new c(o));const n=$(t);n&&w(n,o)}function w(t,o,e){var r;if(!t)return;let n;n=t.type==="CIMTextSymbol"?t.symbol:t;const l=(n==null?void 0:n.type)==="CIMPolygonSymbol";if(n!=null&&n.symbolLayers)for(const a of n.symbolLayers){if(a.colorLocked||l&&(C(a)||M(a)&&a.markerPlacement&&S(a.markerPlacement)))continue;const i=o.toArray();switch(a.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":a.tintColor=i;break;case"CIMVectorMarker":(r=a.markerGraphics)==null||r.forEach(s=>{w(s.symbol,o)});break;case"CIMSolidStroke":case"CIMSolidFill":a.color=i;break;case"CIMHatchFill":w(a.lineSymbol,o)}}}const L="picture-fill",x="simple-fill",U="simple-line",P="simple-marker",V="text",G="cim",g=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),b=new _(1e3);function it(t){const o=t.style;let e=null;if(t)switch(t.type){case P:o!=="cross"&&o!=="x"&&(e=t.color);break;case x:o&&o!=="solid"?o!=="none"&&(e={type:"pattern",x:0,y:0,src:F(`esri/symbols/patterns/${o}.png`),width:5,height:5}):e=t.color;break;case L:e={type:"pattern",src:t.url,width:f(t.width)*t.xscale,height:f(t.height)*t.yscale,x:f(t.xoffset),y:f(t.yoffset)};break;case V:e=t.color;break;case G:e=I(t)}return e}function ct(t,o){const e=t+"-"+o;return b.get(e)!==void 0?Promise.resolve(b.get(e)):R(t,{responseType:"image"}).then(n=>{const l=n.data,r=l.naturalWidth,a=l.naturalHeight,i=document.createElement("canvas");i.width=r,i.height=a;const s=i.getContext("2d");s.fillStyle=o,s.fillRect(0,0,r,a),s.globalCompositeOperation="destination-in",s.drawImage(l,0,0);const u=i.toDataURL();return b.put(e,u),u})}function j(t){if(!t)return null;let o=null;switch(t.type){case x:case L:case P:o=j(t.outline);break;case U:{const e=f(t.width);t.style!=null&&t.style!=="none"&&e!==0&&(o={color:t.color,style:J(t.style),width:e,cap:t.cap,join:t.join==="miter"?f(t.miterLimit):t.join},o.dashArray=q(o).join(",")||"none");break}default:o=null}return o}function q(t){if(!(t!=null&&t.style))return[];const{dashArray:o,style:e,width:n}=t;if(typeof o=="string"&&o!=="none")return o.split(",").map(a=>Number(a));const l=n??0,r=g.has(e)?g.get(e).map(a=>a*l):[];if(t.cap!=="butt")for(const[a,i]of r.entries())r[a]=a%2==1?i+l:Math.max(i-l,1);return r}const J=(()=>{const t={};return o=>{if(t[o])return t[o];const e=o.replaceAll("-","");return t[o]=e,e}})(),ut=new c([128,128,128]),Q=new c("white");function W(t){var e,n;const o=(e=t.symbolLayers)==null?void 0:e.at(-1);if(o&&"outline"in o)return(n=o==null?void 0:o.outline)==null?void 0:n.size}function ft(t){var o;if(!t)return 0;if(m(t)){const e=W(t);return e??0}return H((o=j(t))==null?void 0:o.width)}function ht(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(o=>o.type==="object");case"line-3d":return t.symbolLayers.some(o=>o.type==="path");case"polygon-3d":return t.symbolLayers.some(o=>o.type==="object"||o.type==="extrude");default:return!1}}function yt(t){var o;return((o=t.resource)==null?void 0:o.href)??""}function mt(t,o){if(!t)return null;let e=null;return m(t)?e=Y(t):p(t)&&(e=t.type==="cim"?I(t):t.color?new c(t.color):null),e?y(e,o):null}function Y(t){const o=t.symbolLayers;if(!o)return null;let e=null;return o.forEach(n=>{var l;n.type==="object"&&((l=n.resource)!=null&&l.href)||(e=n.type==="water"?n.color:n.material?n.material.color:null)}),e?new c(e):null}function y(t,o){if(o==null||t==null)return t;const e=t.toRgba();return e[3]=e[3]*o,new c(e)}function B(t,o,e){const n=t.symbolLayers;if(!n)return;const l=r=>y(o=o??r??(e!=null?Q:null),e);n.forEach(r=>{var a,i;if(r.type!=="object"||!((a=r.resource)!=null&&a.href)||o)if(r.type==="water")r.color=l(r.color);else{const s=r.material!=null?r.material.color:null,u=l(s);r.material==null?r.material=new N({color:u}):r.material.color=u,e!=null&&"outline"in r&&((i=r.outline)==null?void 0:i.color)!=null&&(r.outline.color=y(r.outline.color,e))}})}function K(t,o,e){var n;(o=o??t.color)&&(t.color=y(o,e)),e!=null&&"outline"in t&&((n=t.outline)!=null&&n.color)&&(t.outline.color=y(t.outline.color,e))}function pt(t,o,e){t&&(o||e!=null)&&(o&&(o=new c(o)),m(t)?B(t,o,e):p(t)&&K(t,o,e))}async function X(t,o){const e=t.symbolLayers;e&&await A(e,async n=>Z(n,o))}async function Z(t,o){switch(t.type){case"extrude":ot(t,o);break;case"icon":case"line":case"text":tt(t,o);break;case"path":nt(t,o);break;case"object":await et(t,o)}}function tt(t,o){const e=z(o);e!=null&&(t.size=e)}function z(t){for(const o of t)if(typeof o=="number")return o;return null}function ot(t,o){t.size=typeof o[2]=="number"?o[2]:0}async function et(t,o){const{resourceSize:e,symbolSize:n}=await rt(t),l=v(o,e,n);t.width=h(o[0],n[0],e[0],l),t.depth=h(o[1],n[1],e[1],l),t.height=h(o[2],n[2],e[2],l)}function nt(t,o){const e=v(o,T,[t.width,void 0,t.height]);t.width=h(o[0],t.width,1,e),t.height=h(o[2],t.height,1,e)}function v(t,o,e){for(let n=0;n<3;n++){const l=t[n];switch(l){case"symbol-value":{const r=e[n];return r!=null?r/o[n]:1}case"proportional":break;default:if(l&&o[n])return l/o[n]}}return 1}async function rt(t){const{computeObjectLayerResourceSize:o}=await D(()=>import("./symbolLayerUtils-B9Z2nG1U.js"),__vite__mapDeps([0,1,2]),import.meta.url),e=await o(t,10),{width:n,height:l,depth:r}=t,a=[n,r,l];let i=1;for(let s=0;s<3;s++){const u=a[s];if(u!=null){i=u/e[s];break}}for(let s=0;s<3;s++)a[s]==null&&(a[s]=e[s]*i);return{resourceSize:e,symbolSize:a}}function h(t,o,e,n){switch(t){case"proportional":return e*n;case"symbol-value":return o??e;default:return t}}function lt(t,o){const e=z(o);if(e!=null)switch(t.type){case"simple-marker":t.size=e;break;case"picture-marker":{const n=t.width/t.height;n>1?(t.width=e,t.height=e*n):(t.width=e*n,t.height=e);break}case"simple-line":t.width=e;break;case"text":t.font.size=e}}async function bt(t,o){if(t&&o)return m(t)?X(t,o):void(p(t)&&lt(t,o))}function dt(t,o,e){if(t&&o!=null)if(m(t)){const n=t.symbolLayers;n&&n.forEach(l=>{if(l&&l.type==="object")switch(e){case"tilt":l.tilt=(l.tilt??0)+o;break;case"roll":l.roll=(l.roll??0)+o;break;default:l.heading=(l.heading??0)+o}})}else p(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=o))}function wt(t){if(!t)return null;const o=t.effects.filter(e=>e.type!=="bloom").map(e=>e.toJSON());return O(o)}async function kt(t,o){return await t.fetchSymbol(o)||t.fetchCIMSymbol(o)}export{dt as D,wt as I,kt as N,bt as R,ht as a,ut as b,pt as c,st as d,ct as f,q as g,mt as h,ft as m,yt as p,it as u,J as w,j as y};
